---
title: "NSci233 Notes- Week 5"
subtitle: Lesson Plan 3 - Precipitation
author: "Charles Jason Tinant"
date: "2/19/2018"
output:
  html_document:
    df_print: paged
fontsize: 12pt
---

## Important Updates
* We will be having a make-up class on Friday Feb 23 from 1-4 PM to work with R-Studio and the rest of Lesson Plan 3 to cover the snow day on Feb 20.  *Note this is a second rechedule of the last supplementary / make-up class that had to be cancelled due to weather.*  Becasue of the snow, I need to reschedule the appointments with two students to resolve issues.

* The most recent versions of the lesson plans can be downloaded from https://github.com/cjtinant/NSci253_Notes 

* I resolved the R-Studio issues for 11/13 students (85%) as of the end of week 4.  **There were two issues that were causing read_csv() not to work:**  

* a space somewhere in the file folder path caused by naming the folder something like "R hydro". The way to resolve this is to use an "_" or a "-" if you want a space in a name.

* the data that R was looking for using read_csv() was not in the same file as the lesson plan, which caused R to be confused.  The way to resolve this is to unzip the file, then copy all of the data you need into your working folder.

* If you have not already, please download the following software to start the remote control tool TeamViewer Quicksupport: http://connect.teamviewer.com/v13   This way, I can take a look at your computer screen and resolve issues.

* The password for your OLC account in Gmail is **r2FAkyV-9p**.  Please log in ASAP to Gmail using your OLC account name and this password.  Then change the password. 

## Overview
Precipitation is the single most important variable driving hydrologic processes and events, because it replenishes soil moisture, lakes and streams, and groundwater.  Precipitation is any form of solid or liquid water the falls from the atmosphere to the earth's surface.  Precipitation can be thought about in terms of events, as averages over a period of time, or as deviations from the normal or "adequate" amount.  In this section we are going to discuss the role of precipition in climate, what causes precipiation, precipitation events, and rainfall frequency.
\newpage

##Student Learning Outcomes (SLOs) &  Lesson Goals:  
- *SLO1: Students will demonstrate proficiency in the components of the hydrologic cycle: precipitation, infiltration, runoff, and evapotranspiration* - Students will be able to generally describe what causes precipiation, precipitation events, and rainfall frequency. 

- *SLO2: Students are able to analyze components of the hydrologic with computer software* - Students will be generally able to read  data into R, and perform some analysis using packages.  Students will will be able to read arguments of a package from R Documentation.

## Reading Assignment
- Read sections 2.7 - 2.8 of the text 
- Article on Capetown water supply (Cape Town, South Africa water crisis)[https://www.vox.com/world/2018/2/9/16964416/cape-town-water-crisis-day-zero-south-africa]

## Homework (note there will be another couple of problems )
You are welcome to turn in homework in Rmd, pdf, html or Word.  Upload the file into a folder with your name in Google Drive. 

###1. Vocabulary - Summarize the terms: weather, climate, frontal precipitation, convection, orographic, stratosphere, troposphere, jet stream
write your answer here...

###2. Use the following link: [Koeppen Climate](http://koeppen-geiger.vu-wien.ac.at/pdf/KG_USA_UScounty.pdf) to download a map of Koeppen climates for the United States. What is the climate for Western South Dakota?  What is the climate for Eastern South Dakota.

2. Use the following link: [Drought Monitor](http://droughtmonitor.unl.edu/) - What is the drought intensity for this week for the county you live in? If your county is in drought, then is the drought short-term or long-term?  What is the drought summary for the High Plains?  What is the the drought summary for the West?

3. Calculate the effective depth in mm and volume of water in the last snowstorm in cubic meters for two watersheds.  Assume the snow has a 10% moisture content, 8 inches of snow fell over a 500 square mile watershed, and 6 inches of snow over a 300 square mile watershed.  Recall: 1 inch = 22.54 mm, 1 square mile = 2.59 square kilometers.

4. Look up the average monthly precipitation totals for the county you live in.  The Drought Monitor may be a helpful resource.  You can use a table to show the precipitation totals using the method discussed on the lower left part of page 2 of the R Markdown cheatsheet that you can download from https://www.rstudio.com/resources/cheatsheets/ 

5. Pick three short-term and three long-term intensities for Table 2.5 and look up on a map the locations they are recorded in.  Based on the geographic location of these areas, what is the process causing the precipitation?

## Looking forward to next week
Next week we will cover rainfall frequency distributions.
\newpage

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

## Lecture Notes with R-code

```{r install_here}
# one of the biggest issues we have been having the first four weeks 
# of class is setting the workspace.  I have taught the most basic
# approach to setting a workspace.  However, given the challenges many
# are experiencing, I want to try a different approach using the 'here'()'
# package.

# download 'here' package -the install function below is commented out.
# install.packages("here")
```

```{r library}
library(here)
library(tidyverse) # load the tidyverse package

here() # this checks where R thinks the working directory is...
```

### Weather, Climate, and Water Resources
**Weather** is the result of the day-to-day movement of moist air masses from thier sources and thier associated effects on precipitation and temperature.  **Climate** is a long-term average of the weather.  Intermediate to weather and climate is a moving window of recent weather history and intermediate term forecasting, and how these relate to the climate.  Precipitation is an important part of both weather and climate.  Too much precipitation on a particular day, *weather,* causes schools to close.  Too little precipitation in a given season results in a drought.  Too much water extraction for the climate generally, or during a drought results in a loss of water resources as (Cape Town is currently experiencing)[https://www.vox.com/world/2018/2/9/16964416/cape-town-water-crisis-day-zero-south-africa].

A lot of systems have been used to describe climate.  The **Koeppen Climate Classification System** is the most widely adopted approach,  Köppen’s classification is based on a subdivision of terrestrial climates into five major types, which are represented by the capital letters A, B, C, D, and E. Except for type B, each of these climate types is defined by temperature criteria. **Type B designates climates in which the controlling factor on vegetation is dryness** (rather than coldness). **Aridity** is not a matter of precipitation alone but is defined by the relationship between the precipitation input to the soil in which the plants grow and the evaporative losses. Since evaporation is difficult to evaluate and is not a conventional measurement at meteorological stations, Köppen was forced to substitute a formula that identifies aridity in terms of a temperature-precipitation index (that is, evaporation is assumed to be controlled by temperature). Dry climates are divided into arid (BW) and semiarid (BS) subtypes, and each may be differentiated further by adding a third code, h for warm and k for cold.  

Temperature defines the other four major climate types. These are subdivided, with additional letters again used to designate the various subtypes. Type A climates (the warmest) are differentiated on the basis of the seasonality of precipitation: Af (no dry season), Am (short dry season), or Aw (winter dry season). Type E climates (the coldest) are conventionally separated into tundra (ET) and snow/ice climates (EF). The mid-latitude C and D climates are given a second letter, f (no dry season), w (winter dry), or s (summer dry), and a third symbol (a, b, c, or d [the last subclass exists only for D climates]), indicating the warmth of the summer or the coldness of the winter. Although Köppen’s classification did not consider the uniqueness of highland climate regions, the highland climate category, or H climate, is sometimes added to climate classification systems to account for elevations above 1,500 metres (about 4,900 feet; source: https://www.britannica.com/science/Koppen-climate-classification).  You can check out the changing climate at http://koeppen-geiger.vu-wien.ac.at/. 

<!--
Small groups: Use Table 2.1 the Koeppen climate map at http://koeppen-geiger.vu-wien.ac.at/pdf/KG_USA_UScounty.pdf to identify the climate of South Dakota. 

Question: Why is ranching the predominant land use west of the Missouri and farming the predominant land use east of the Missouri?**
-->

For land and water resources management, one important tool is the **Drought Monitor** (http://droughtmonitor.unl.edu/).  The Drought Monitor describes weather trends, and relates them to long-range weather forecasts and the climate.   

<!--
Small groups: Quickly look at the drought monitor website
-->

## Causes of Precipitation
The precipitation process begins when water droplets condense in the atmosphere around dust, smoke, or ice particles.  As the droplet size increases it reaches a size at which gravity begins to pull them down.  Condensensation is caused by cooling, which is caused by the lifting of air masses.  There are three processes that lift air masses: 
* Frontal air masses - frontal precipitation, 
* Convection - thunderstorms, 
* Mountains - orographic precipitation.  

** Frontal precipitation ** occurs when warm moist air masses meet colder, heavier air masses.  It is the dominant precipitation type in the northern United States, and other mid-latitude areas, and is caused by differences in the temperature and pressure of air packets.  Weather fronts, the places where air packets meet, are associated with mid-latitude cyclones (low pressure) moving from west to east.  Pressure refers to **barometric pressure**, the force exerted by the weight of air above a surface.  At sea level, that average pressure exerted by air is 1 atm = 29.01.325 kPa.  This is also equal to 29.92 inches of mercury (Hg) or 406.6 inches of liquid water. In the Northern Hemisphere, air circulates counterclockwise around low-pressure areas, so warm air is most often found in the south and east of low-pressure areas.  The **troposphere**, the 4 to 11 mile thick layer of atmosphere where packets of air that weather occur, is steered by the **jet stream** in the **stratosphere**.

** Convection** occurs as moist air near the surface heated by solar radiation becomes lighter and rises up.  The rising air and latent heat released by water changing phase causes atmospheric instability, and possibly late afternoon thundershowers.  Convective precipitation also can result as air flows into the center of a low pressure system and chills until the moisture in the air reaches saturation.  Hurricanes are a large-scale convective storm cell that forms up in the tropics and generally move northerly.

**Orographic** effects are caused by moist air rising over mountains.  These effects cause the high amounts of snow in mountains, as well as the rain shadow east of the mountains.

<!--
See figures 2.4 & 2.5 showing the air  masses that cause precipitaiton patterns in the United States
-->

## Precipitation Events  
Storms can be described by **type**, **amount**, and **duration**.
* type - hail, rain, snow, sleet;
* amount - depth of precipitation (as rain or as snow);
* duration - length of time the storm is occurring.  

** intensity** is the *average rate* of precipation found by $intensity(mm/hr) = \frac{depth (mm)}{duration (hr)}$.  Another useful thing to consider is an event's **return period**, the average number of years between storms of a particular magnitude.  *We will discuss return period in more detail next week.*

We usually think about precipitation as a **depth** rather than a volume.  We can use the equation $Vol = depth * area$. To find out the average volume of water from a **depth** of water that falls on each country each year, we need to multiply the land area by the precipitation depth.  

```{r continental_precipitation}
# We are going to calculate a volume from a given depth of water
# -> we need to pay close attention to units 
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Review: we can quickly add data together in R rather than read it in
# from a .csv file using the 'concatinate' function, c().  Than using the 
# 'tidyverse', we can easily bind rows and columns together.

# make a vector of strings with continent names and a vector of area values 
continent <- c("Africa", "North America", "South America", "Asia", 
               "Europe", "Oceania")
depth_in <- c(27, 26.4, 64.9, 28.6, 28.9, 29.0)
area_thos_km2 <- c(3022, 2471, 1784, 4458, 1018, 853)

# turn the vectors into data.frames & remove the old data
continent <- as.data.frame(continent)
depth_in <- as.data.frame(depth_in) 
area_thos_km2 <- as.data.frame(area_thos_km2) 

# bind the two vectors together and then make it into a data-frame
precip <- bind_cols(continent, depth_in)
precip <- bind_cols(precip, area_thos_km2)
rm(continent, depth_in, area_thos_km2)
```

<!-- Get into groups and  write equation in the code chunk below to: 1) change precipitation depth in inches to millimeters, 2) calculate a volume in cubic kilometers, 3) change the volume to cubic meters,  4) check your answer by hand.
-->

```{r calculate_precip_vol_question}
# 1 inch equals 22.54 mm
# 1,000,000 mm (10^6 mm) = 1 km

# Use the 'mutate' function
# You can use the '%>%' called a pipe to connect parts together.



```

```{r convert_in_to_mm_answer}
precip <- precip %>%
  mutate(depth_mm = 22.54 * depth_in) %>%
  mutate(precip_km3 = area_thos_km2 * 10^3 * depth_mm *10^-6) %>%
  mutate(precip_m3 = precip_km3 * 10^9)
```

### Geographical and seasonal variations
Precipitation varies by season and by location.  Average annual precipitation in the United States is 30 inches (75 cm), but there is great spatial variation across the country by location and by season (Figures 2.4 - 2.6 in text).

 <!-- Get into groups, and identify: 1) the sources of winter precipitation across the West Coast, 2) sources of summer and winter precipitation in the Dakotas, and 3) idnentify why the precipitation is so much lower in Idaho, Utah, Arizona, and New Mexico (4-20 inches vs up to 140 inches in the Pacific Northwest.
-->

### Historic time trends
Climate tends to have distinct wetter and drier periods (Figure 2.7), with periods of 3-7, 15-20, 100 or so recurrence intervals having been defined.  Different approaches to showing variability in the region influenced by the Great Lakes using trend lines, running averages to smooth the data, and standard deviations.

### Averaging over space and time
The averaging period for rainfall depth and intensity can be important, depending on the question of interest.  Shorter averaging periods (15 minute data or shorter) can show differences in intensity over a storm.  However, daily or even monthly data is useful for most hydrologic budget studies.

Precipitation is measured at points often using tipping rainfall buckets, or by pillows to measure the snowfall mass.  These point measurements can be averaged over an area such as a watershed using different approaches such as Theissen polygons and contouring that can be automated in ArcGIS or R.

### Rainfall freqency distributions






```{r}
# I collected station data for Cottonwood station, SD from 
# NOAA's National Centers for Environmental Information (NCEI)
# https://www.ncdc.noaa.gov/cdo-web/






# Here is what the columns mean
#EVAP - Evaporation of water from evaporation pan
#DAPR - Number of days included in the multiday precipitation total (MDPR)
#DAEV - Number of days included in the multiday evaporation total (MDEV)
#SNOW - Snowfall
#PRCP - Precipitation
#MNPN - Daily minimum temperature of water in an evaporation pan
#MDEV - Multiday evaporation total (use with DAEV)
#MXPN - Daily maximum temperature of water in an evaporation pan
#MDPR - Multiday precipitation total (use with DAPR and DWPR, if available)
#MDSF - Multiday snowfall total
#SNWD - Snow depth
#DASF - Number of days included in the multiday snow fall total (MDSF) 
```


